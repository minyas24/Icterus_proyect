geom_sf(data= shp_clean, aes(col = species), col="red4")+
coord_sf(xlim = c(-97, -85), ylim = c(25, 15))+
scale_fill_paletteer_c("grDevices::terrain.colors",
limits = c(0, 5000),
na.value = "transparent")
map_ini <- ggplot()+
geom_spatraster(data= alt)+
geom_sf(data= shp_clean, aes(col = species), col="red4")+
coord_sf(xlim = c(-120, -77), ylim = c(32, 10))+
scale_fill_paletteer_c("grDevices::terrain.colors",
limits = c(0, 5000),
na.value = "transparent")+
annotation_north_arrow(location = "bl", which_north = "true",
pad_x = unit(0.75, "cm"), pad_y = unit(0.5, "cm"),
style = north_arrow_fancy_orienteering)
map_ini
mapini_02 <- (map_ini +map_ini_close) +
plot_annotation(
title = "Distribución de Icterus auratus",
subtitle = "Registros de ocurrencia sobre modelo de elevación",
caption = "Fuente: GBIF")+
annotation_north_arrow(location = "bl", which_north = "true",
pad_x = unit(0.75, "cm"), pad_y = unit(0.5, "cm"),
style = north_arrow_fancy_orienteering)
mapini_02
install.packages("png")
library(png)
img <- readPNG("R_Icterus/I_data/I_auratus.png")
mapini_02 <- map_ini + (img/map_ini_close) +
plot_annotation(
title = "Distribución de Icterus auratus",
subtitle = "Registros de ocurrencia sobre modelo de elevación",
caption = "Fuente: GBIF")+
annotation_north_arrow(location = "bl", which_north = "true",
pad_x = unit(0.75, "cm"), pad_y = unit(0.5, "cm"),
style = north_arrow_fancy_orienteering)
mapini_02 <- (map_ini | img) / map_ini_close +
plot_annotation(
title = "Distribución de Icterus auratus",
subtitle = "Registros de ocurrencia sobre modelo de elevación",
caption = "Fuente: GBIF")+
annotation_north_arrow(location = "bl", which_north = "true",
pad_x = unit(0.75, "cm"), pad_y = unit(0.5, "cm"),
style = north_arrow_fancy_orienteering)
path <- "I_auratus.png"
img <- readPNG(path, native = TRUE)
path <- "R_Icterus/I_data/I_auratus.png"
img <- readPNG(path, native = TRUE)
cow_final <- ggdraw() +
draw_plot(o) +
draw_image(image = img, x = 0.14, y =  0.24, scale = 0.25)
install.packages("grid")
library(grid)
path <- "R_Icterus/I_data/I_auratus.png"
img <- readPNG(path, native = TRUE)
cow_final <- ggdraw() +
draw_plot(o) +
draw_image(image = img, x = 0.14, y =  0.24, scale = 0.25)
install.packages("cowplot")
library(cowplot)
path <- "R_Icterus/I_data/I_auratus.png"
img <- readPNG(path, native = TRUE)
cow_final <- ggdraw() +
draw_plot(o) +
draw_image(image = img, x = 0.14, y =  0.24, scale = 0.25)
path <- "R_Icterus/I_data/I_auratus.png"
img <- readPNG(path, native = TRUE)
cow_final <- ggdraw() +
draw_image(image = img, x = 0.14, y =  0.24, scale = 0.25)
mapini_02 <- (map_ini | img) / map_ini_close +
plot_annotation(
title = "Distribución de Icterus auratus",
subtitle = "Registros de ocurrencia sobre modelo de elevación",
caption = "Fuente: GBIF")+
annotation_north_arrow(location = "bl", which_north = "true",
pad_x = unit(0.75, "cm"), pad_y = unit(0.5, "cm"),
style = north_arrow_fancy_orienteering)
mapini_02
mapini_02 <- (map_ini_close | img) /map_ini  +
plot_annotation(
title = "Distribución de Icterus auratus",
subtitle = "Registros de ocurrencia sobre modelo de elevación",
caption = "Fuente: GBIF")+
annotation_north_arrow(location = "bl", which_north = "true",
pad_x = unit(0.75, "cm"), pad_y = unit(0.5, "cm"),
style = north_arrow_fancy_orienteering)
mapini_02
mapini_02 <-  map_ini/(map_ini_close | img)  +
plot_annotation(
title = "Distribución de Icterus auratus",
subtitle = "Registros de ocurrencia sobre modelo de elevación",
caption = "Fuente: GBIF")+
annotation_north_arrow(location = "bl", which_north = "true",
pad_x = unit(0.75, "cm"), pad_y = unit(0.5, "cm"),
style = north_arrow_fancy_orienteering)
mapini_02
ggsave("R_icterus/I_salidas/icter_map_ini02.png",
plot = mapini_02,
dpi = 300,
width = 12,
height = 9,
units = "in")
env2 <- readRDS("datos_wc/climate/wc2.1_30s/bio_enviromental.rds")
v_names <- vector()
for(i in 1:19){
v_names[i] <- paste0("bio_", sprintf("%02d", i)) #sprintf(formato de 2 dígitos)
}
names(env) <- v_names
head(env)
env
names(env)
coord_elev <- shp_clean
puntos_sf <- st_as_sf(coord_elev, coords = c("lon", "lat"), crs = 4326)
elevaciones <- terra::extract(alt, puntos_sf)
elevaciones
puntos_sf$elev <- elevaciones$wc2.1_30s_elev
print(puntos_sf)
coord_bio <- shp_clean
env_icter <- terra::extract(env, coord_bio) %>% as_tibble() #extract, capa ambiental y el lugar al que queremos enviar la información
print(env_icter)
df_icter <- cbind.data.frame(puntos_sf, env_icter)%>%
filter(!is.na(elev))%>% #quita NA
write_csv("R_Icterus/I_data/I_auratus_02_env.csv")
print(df_icter)
print(df_icter)
head("df_icter")
plot(df_icter$decimalLongitude, df_icter$decimalLatitude,
xlab = "Longitud",
ylab = "Latitud",
sub = "Icterus auratus",
cex.sub = 0.5,
font.sub = 3)
thin( loc.data = df_icter,
lat.col =  "decimalLatitude", long.col = "decimalLongitude",
spec.col = "species",
thin.par = 10, reps = 100,
locs.thinned.list.return = TRUE,
write.files = TRUE,
write.log.file = TRUE,
out.dir = here("R_Icterus", "I_data", "output_I2_thin" ))
sthin <- read_csv(here("R_Icterus", "I_data", "output_I2_thin", "thinned_data_thin1.csv"))
points(sthin$decimalLongitude, sthin$decimalLatitude, col = "orange", pch = 20)
sthin <- read_csv(here("R_Icterus", "I_data", "output_I2_thin", "thinned_data_thin1.csv"))
points(sthin$decimalLongitude, sthin$decimalLatitude, col = "orange", pch = 20)+
plot_annotation(title = "Aclaramiento de ocurrencias")
sthin <- read_csv(here("R_Icterus", "I_data", "output_I2_thin", "thinned_data_thin1.csv"))
points(sthin$decimalLongitude, sthin$decimalLatitude, col = "orange", pch = 20, title = "Aclaramiento de ocurrencias")
plot(df_icter$decimalLongitude, df_icter$decimalLatitude,
xlab = "Longitud",
ylab = "Latitud",
title = "Aclaramiento de ocurrencias"
sub = "Icterus auratus",
head("df_icter")
plot(df_icter$decimalLongitude, df_icter$decimalLatitude,
xlab = "Longitud",
ylab = "Latitud",
title = "Aclaramiento de ocurrencias"
sub = "Icterus auratus",
head("df_icter")
plot(df_icter$decimalLongitude, df_icter$decimalLatitude,
xlab = "Longitud",
ylab = "Latitud",
title = "Aclaramiento de ocurrencias",
sub = "Icterus auratus",
cex.sub = 0.5,
font.sub = 3)
head("df_icter")
plot(df_icter$decimalLongitude, df_icter$decimalLatitude,
xlab = "Longitud",
ylab = "Latitud",
main = "Aclaramiento de ocurrencias",
sub = "Icterus auratus",
cex.sub = 0.5,
font.sub = 3)
sthin <- read_csv(here("R_Icterus", "I_data", "output_I2_thin", "thinned_data_thin1.csv"))
points(sthin$decimalLongitude, sthin$decimalLatitude, col = "orange", pch = 20)
png(file = here("R_Icterus/I_data/I_salidas/I_02spthin.png", width = 666, height = 740)
head("df_icter")
png(file = here("R_Icterus/I_data/I_salidas/I_02spthin.png", width = 666, height = 740)
plot(df_icter$decimalLongitude, df_icter$decimalLatitude,
png(file = here("R_Icterus/I_data/I_salidas/I_02spthin.png", width = 666, height = 740)
head("df_icter")
head("shp_clean")
plot(df_icter$decimalLongitude, df_icter$decimalLatitude,
xlab = "Longitud",
ylab = "Latitud",
main = "Aclaramiento de ocurrencias",
sub = "Icterus auratus",
cex.sub = 0.5,
font.sub = 3)
png(file = here("R_Icterus/I_data/I_salidas/I_02spthin.png",
width = 666,
height = 740)
head("shp_clean")
png(file = here("R_Icterus/I_data/I_salidas/I_02spthin.png",
width = 666,
height = 740)
head(shp_clean)
head(shp_clean)
plot(df_clean$decimalLongitude, df_clean$decimalLatitude,
xlab = "Longitud",
ylab = "Latitud",
main = "Aclaramiento de ocurrencias",
sub = "Icterus auratus",
cex.sub = 0.5,
font.sub = 3)
png(file = here("R_Icterus/I_data/I_salidas/I_02spthin.png",
width = 666,
height = 740)
head(shp_clean)
png(file = here("R_Icterus/I_data/I_salidas/I_02spthin.png",
width = 666,
height = 740)
plot(df_clean$decimalLongitude, df_clean$decimalLatitude,
png(file = here("R_Icterus", "I_data", "I_salidas", "I_02spthin.png"),
width = 666,
height = 740)
png(file = here("R_Icterus", "I_data", "I_salidas", "I_02spthin.png"),
width = 666,
height = 740)
png(file = here("R_Icterus", "I_data", "I_salidas", "I_02spthin.png"),
width = 666,
height = 740)   # Paréntesis cerrado correctamente
png(file = here("R_Icterus/I_data/I_salidas/I_2spthin.png",
width = 666,
height = 740)
plot(df_clean$decimalLongitude, df_clean$decimalLatitude,
png(file = here("R_Icterus/I_salidas/I_2spthin.png",
width = 666,
height = 740)
plot(df_clean$decimalLongitude, df_clean$decimalLatitude,
png(file = here("R_Icterus/I_salidas/I_02spthin.png"),
width = 666,
height = 740)
plot(df_clean$decimalLongitude, df_clean$decimalLatitude,
xlab = "Longitud",
ylab = "Latitud",
main = "Aclaramiento de ocurrencias",
sub = "Icterus auratus",
cex.sub = 0.5,
font.sub = 3)
sthin <- read_csv(here("R_Icterus", "I_data", "output_I2_thin", "thinned_data_thin1.csv"))
points(sthin$decimalLongitude, sthin$decimalLatitude, col = "orange", pch = 20)
#
dev.off()
png(file = here("R_Icterus/I_salidas/I_02spthin.png"),
width = 1000,
height = 1000)
plot(df_clean$decimalLongitude, df_clean$decimalLatitude,
xlab = "Longitud",
ylab = "Latitud",
main = "Aclaramiento de ocurrencias",
sub = "Icterus auratus",
cex.sub = 0.5,
font.sub = 3)
sthin <- read_csv(here("R_Icterus", "I_data", "output_I2_thin", "thinned_data_thin1.csv"))
points(sthin$decimalLongitude, sthin$decimalLatitude, col = "orange", pch = 20)
#
dev.off()
png(file = here("R_Icterus/I_salidas/I_02spthin.png"),
width = 1000,
height = 1000)
plot(df_clean$decimalLongitude, df_clean$decimalLatitude,
xlab = "Longitud",
ylab = "Latitud",
main = "Aclaramiento de ocurrencias",
sub = "Icterus auratus",
cex.sub = 0.5,
font.sub = 3)
sthin <- read_csv(here("R_Icterus", "I_data", "output_I2_thin", "thinned_data_thin1.csv"))
points(sthin$decimalLongitude, sthin$decimalLatitude, col = "red"", pch = 20)
#
dev.off()
sthin <- read_csv(here("R_Icterus", "I_data", "output_I2_thin", "thinned_data_thin1.csv"))
png(file = here("R_Icterus/I_salidas/I_02spthin.png"),
width = 1000,
height = 1000)
plot(df_clean$decimalLongitude, df_clean$decimalLatitude,
xlab = "Longitud",
ylab = "Latitud",
main = "Aclaramiento de ocurrencias",
sub = "Icterus auratus",
cex.sub = 0.5,
font.sub = 3)
sthin <- read_csv(here("R_Icterus", "I_data", "output_I2_thin", "thinned_data_thin1.csv"))
points(sthin$decimalLongitude, sthin$decimalLatitude, col = "red"", pch = 20)
sthin <- read_csv(here("R_Icterus", "I_data", "output_I2_thin", "thinned_data_thin1.csv"))
png(file = here("R_Icterus/I_salidas/I_02spthin.png"),
width = 1000,
height = 1000)
plot(df_clean$decimalLongitude, df_clean$decimalLatitude,
xlab = "Longitud",
ylab = "Latitud",
main = "Aclaramiento de ocurrencias",
sub = "Icterus auratus",
cex.sub = 0.5,
font.sub = 3)
sthin <- read_csv(here("R_Icterus", "I_data", "output_I2_thin", "thinned_data_thin1.csv"))
points(sthin$decimalLongitude, sthin$decimalLatitude, col = "red", pch = 20)
#
dev.off()
inicial <- df_icter
inicial <- df_icter
thinned_data_thin1 <- read_csv(here("R_Icterus", "I_data","output_I2_thin", "thinned_data_thin1.csv"))
icter_spthin <- thinned_data_thin1 %>%
left_join(inicial,
by = c("species" = "species",
"decimalLongitude" = "decimalLongitude",
"decimalLatitude" = "decimalLatitude" ))%>%
select(-ID)# "thinned_data_thin1" = "inicial"
which(is.na(icter_spthin$gbifID))
which(is.na(icter_spthin$gbifID))
write_csv(icter_spthin, "R_Icterus/I_data/output_I2_thin/I_02_spthin.csv")
datos_inicial <- nrow(inicial)
datos_fin <-nrow(thinned_data_thin1)
datos_elim <- datos_inicial - datos_fin
print(paste0("spThin/ Número inicial: ", datos_inicial, ", eliminados: ", datos_elim, ", Número final: ", datos_fin))
matriz_cor <- cor(subset(icter_spthin, select = -c(species, decimalLatitude, decimalLongitude, month, year, gbifID, geometry)))
corr <- ggcorrplot(matriz_cor, #matriz de correlación
hc.order = FALSE, #si se ordena por un m?todo (HCLUST) o por default
type = "lower", #si se muestra toda o una secci?n
lab = TRUE, #si se agregan los d?gitos
lab_size = 3, #tama?o de los d?gitos
colors= c("#80FFFF", "#FFF7FF", "#FF80FF"),
ggtheme = theme_minimal()) #vector de colores
corr
ggsave("R_Icterus/I_salidas/corr.png",
plot = corr,
dpi = 300,
width = 12,
height = 9,
units = "in")
columnas_a_eliminar <- findCorrelation(matriz_cor, cutoff = 0.7, names = TRUE)
columnas_a_eliminar
icter_corr <- icter_spthin %>%
select(-columnas_a_eliminar)%>%
write_csv("R_Icterus/I_data/Iauratus_corr.csv")
df_means <- icter_corr %>%
select(-month, -year, -gbifID, -geometry, -decimalLongitude, -decimalLatitude) %>%
select(where(is.numeric)) %>%
scale() %>%
as.data.frame()
corr <- ggcorrplot(matriz_cor, #matriz de correlación
hc.order = FALSE, #si se ordena por un m?todo (HCLUST) o por default
type = "lower", #si se muestra toda o una secci?n
lab = TRUE, #si se agregan los d?gitos
lab_size = 3, #tama?o de los d?gitos
colors= c("#80FFFF", "#FFF7FF", "#FF80FF"),
ggtheme = theme_minimal())+
labs(title = "Matriz de correlación para I. auratus")
corr
ggsave("R_Icterus/I_salidas/corr.png",
plot = corr,
dpi = 300,
width = 12,
height = 9,
units = "in")
fviz_nbclust(df_means, kmeans, method = "wss") + geom_vline(xintercept = 3, linetype = 2)
agrupamiento <- fviz_nbclust(df_means, kmeans, method = "wss") + geom_vline(xintercept = 3, linetype = 2)
agrupamiento
ggsave("R_Icterus/I_salidas/agrupamiento.png",
plot = corr,
dpi = 300,
width = 12,
height = 9,
units = "in")
ggsave("R_Icterus/I_salidas/agrupamiento.png",
plot = agrupamiento,
dpi = 300,
width = 12,
height = 9,
units = "in")
set.seed(123)
icter_means <- kmeans(df_means, 6, nstart = 25)
table(icter_means$cluster)
fviz_cluster(icter_means, data = df_means,
palette = c("#0000FF", "#C870FF", "#74C9BC", "#7F8A8F", "#BB173A", "#C4D8F3"),
ggtheme = theme_minimal())
set.seed(123)
icter_means <- kmeans(df_means, 5, nstart = 25)
table(icter_means$cluster)
fviz_cluster(icter_means, data = df_means,
palette = c("#0000FF", "#C870FF", "#74C9BC", "#7F8A8F", "#BB173A", "#C4D8F3"),
ggtheme = theme_minimal())
set.seed(123)
icter_means <- kmeans(df_means, 4, nstart = 25)
table(icter_means$cluster)
fviz_cluster(icter_means, data = df_means,
palette = c("#0000FF", "#C870FF", "#74C9BC", "#7F8A8F", "#BB173A", "#C4D8F3"),
ggtheme = theme_minimal())
set.seed(123)
icter_means <- kmeans(df_means, 3, nstart = 25)
table(icter_means$cluster)
fviz_cluster(icter_means, data = df_means,
palette = c("#0000FF", "#C870FF", "#74C9BC", "#7F8A8F", "#BB173A", "#C4D8F3"),
ggtheme = theme_minimal())
set.seed(123)
icter_means <- kmeans(df_means, 6, nstart = 25)
table(icter_means$cluster)
fviz_cluster(icter_means, data = df_means,
palette = c("#0000FF", "#C870FF", "#74C9BC", "#7F8A8F", "#BB173A", "#C4D8F3"),
ggtheme = theme_minimal())
agrupamiento <- fviz_nbclust(df_means, kmeans, method = "wss") + geom_vline(xintercept = 6, linetype = 2)
agrupamiento
ggsave("R_Icterus/I_salidas/agrupamiento.png",
plot = agrupamiento,
dpi = 300,
width = 12,
height = 9,
units = "in")
agrupamiento <- fviz_nbclust(df_means, kmeans, method = "wss") +
geom_vline(xintercept = 6, linetype = 2)+
labs(title = "Clústers óptimos para I. auratus")
agrupamiento
agrupamiento <- fviz_nbclust(df_means, kmeans, method = "wss") +
geom_vline(xintercept = 6, linetype = 2)+
labs(title = "Clústers óptimos para I. auratus",
xlab = "Número de clusters k",
ylab = "Varianza dentro de los clústers")
agrupamiento
agrupamiento <- fviz_nbclust(df_means, kmeans, method = "wss") +
geom_vline(xintercept = 6, linetype = 2)+
labs(title = "Clústers óptimos para I. auratus",
x = "Número de clusters k",
y = "Varianza dentro de los clústers")
agrupamiento
ggsave("R_Icterus/I_salidas/agrupamiento.png",
plot = agrupamiento,
dpi = 300,
width = 12,
height = 9,
units = "in")
kmeans_grf <- fviz_cluster(icter_means, data = df_means,
palette = c("#0000FF", "#C870FF", "#74C9BC", "#7F8A8F", "#BB173A", "#C4D8F3"),
ggtheme = theme_minimal())
kmeans_grf
ggsave("R_Icterus/I_salidas/kmeans.png",
plot = kmeans_grf,
dpi = 300,
width = 12,
height = 9,
units = "in")
icter_clusters <- icter_corr %>%
mutate(cluster = icter_means$cluster)
datos_filtrados <- icter_clusters %>%
filter(cluster != 1 & cluster != 5)%>%
write_csv("R_Icterus/I_data/I_auratus_kmeans.csv")
datos_inicial <- nrow(icter_corr)
datos_fin <-nrow(datos_filtrados)
datos_elim <- datos_inicial - datos_fin
print(paste0("Kmeans/ Número inicial: ", datos_inicial, ", eliminados: ", datos_elim, ", Número final: ", datos_fin))
consulta_A <- name_suggest("Icterus")$data
library(tidyverse)
library(dplyr)
library(here)
library(readr)
library(rgbif) #descargar datos de ocurrencias
library(sf) #manipulación  de datos vectoriales
library(rworldxtra) #datos vectoriales de los paises del mundo
library(usethis) #credenciales
library(CoordinateCleaner) #limpieza de coordenadas
library(geodata) #datos geoespaciales complemenatarios
library(ggspatial)#auxiliar para visualizar datos espaciales
library(terra) #datos raster
library(tidyterra) #maniipulación de raster
library(paletteer) #colores
library(cluster)
library(spThin)
library(colorspace)
library(ggcorrplot) #diagrama de correlaciones
library(ggridges) #gráfico de ridges
library(plotly) #gráficos avanzados
library(ggplot2) #graficos
library(factoextra)  #estimación de clústers
library(ggpubr)  #visualización cluster
library(patchwork) #organizar gráficos
library(magick)
library(png)
library(grid)
library(cowplot)
library(caret) #co
consulta_A <- name_suggest("Icterus")$data
consulta_1 <- name_backbone("Icterus auratus")
consulta 2 <- name_backbone("Icterus dominicensis")
consulta_2 <- name_backbone("Icterus dominicensis")
keyid <- name_backbone("Icterus auratus")$usageKey
usethis::edit_r_environ()
user <- Sys.getenv("gbif_user")
pwd <- Sys.getenv("gbif_pwd")
email <-Sys.getenv("gbif_email")
descarga_gbif  <- occ_download(
pred("taxonKey", keyid),
pred("hasCoordinate", TRUE),
pred("hasGeospatialIssue", FALSE),
pred("occurrenceStatus","PRESENT"),
user = user,
pwd = pwd,
email = email
)
print(descarga_gbif)
occ_download_wait('0002799-251025141854904')
df_gbif <- descarga_gbif%>%
occ_download_get() %>% #descarga el zip
occ_download_import() #
df_cleaning <- df_gbif %>%
cc_equ(test = "identical", #default es "absolute"
value = "clean")%>%
clean_coordinates(tests = c("capitals", "centroids", "gbif", "institutions", "outliers", "seas",
"zeros"),
value = "clean",
verbose = TRUE)%>% #informe de proceso
write_csv("R_Icterus/I_data/I_10_cleaning.csv")
